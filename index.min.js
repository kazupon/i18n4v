!function(t,e,n){"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define(t,n):e[t]=n()}("i18n",this,function(){"use strict";function t(){this.data={values:{},contexts:[]},this.globalContext={},this.updateCallbacks={}}var e=function(){if("undefined"==typeof navigator)return!1;var t=navigator.userAgent.toLowerCase();return t.indexOf("msie")!==-1&&parseInt(t.split("msie")[1])<9}();t.prototype.translate=function(t,e,n,a,r){var o,l,i;null==r&&(r=this.globalContext);var u=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t};return u(e)?(o=null,i=null,l=e,r=n||this.globalContext):"number"==typeof e?(o=null,i=e,l=n,r=a||this.globalContext):(o=e,"number"==typeof n?(i=n,l=a):(i=null,l=n,r=a||this.globalContext)),u(t)?(u(t.i18n)&&(t=t.i18n),this.translateHash(t,r)):this.translateText(t,i,l,r,o)},t.prototype.addCallback=function(t){for(var e=Date.now();this.updateCallbacks[e];)e++;return this.updateCallbacks[e]=t,e},t.prototype.removeCallback=function(t){delete this.updateCallbacks[t]},t.prototype.add=function(t,e){var n;if(null!=t.values){var a=t.values;for(var r in a)this.data.values[r]=a[r]}if(null!=t.contexts){var o=t.contexts;n=[];for(var l=0,i=o.length;l<i;l++)n.push(this.data.contexts.push(o[l]))}for(var u in this.updateCallbacks)this.updateCallbacks.hasOwnProperty(u)&&this.updateCallbacks[u](e);return n},t.prototype.setContext=function(t,e){return this.globalContext[t]=e},t.prototype.clearContext=function(t){return this.globalContext[t]=null},t.prototype.reset=function(){return this.resetData(),this.resetContext()},t.prototype.resetData=function(){return this.data={values:{},contexts:[]}},t.prototype.resetContext=function(){return this.globalContext={}},t.prototype.translateHash=function(t,e){for(var n in t){var a=t[n];"string"==typeof a&&(t[n]=this.translateText(a,null,null,e))}return t},t.prototype.translateText=function(t,e,n,a,r){var o;if(null==a&&(a=this.globalContext),null==this.data)return this.useOriginalText(r||t,e,n);var l=this.getContextData(this.data,a);return null!=l&&(o=this.findTranslation(t,e,n,l.values,r)),null==o&&(o=this.findTranslation(t,e,n,this.data.values,r)),null==o?this.useOriginalText(r||t,e,n):o},t.prototype.findTranslation=function(t,e,n,a){var r=a[t];if(null==r)return null;if(null==e){if("string"==typeof r)return this.applyFormatting(r,e,n)}else if(r instanceof Array||r.length)for(var o=0,l=r.length;o<l;o++){var i=r[o];if((e>=i[0]||null===i[0])&&(e<=i[1]||null===i[1])){var u=this.applyFormatting(i[2].replace("-%n",String(-e)),e,n);return this.applyFormatting(u.replace("%n",String(e)),e,n)}}return null},t.prototype.getContextData=function(t,e){if(null==t.contexts)return null;for(var n=t.contexts,a=0,r=n.length;a<r;a++){var o=n[a],l=!0,i=o.matches;for(var u in i)l=l&&i[u]===e[u];if(l)return o}return null},t.prototype.useOriginalText=function(t,e,n){return null==e?this.applyFormatting(t,e,n):this.applyFormatting(t.replace("%n",String(e)),e,n)},t.prototype.applyFormatting=function(t,e,n){var a,r;for(a in n)r=new RegExp("%{"+a+"}","g"),t=t.replace(r,n[a]);return t},t.prototype.applyToHTML=function(t){t="undefined"==typeof t?document:t;for(var n=t.querySelectorAll("[data-i18n]"),a=0;a<n.length;a++){var r=n[a],o=r.getAttribute("data-i18n"),l=r.hasAttribute("data-i18n-safe");if(!o){if(1!==r.childNodes.length){r.removeAttribute("data-i18n");continue}var i=r.childNodes[0];if(3!==i.nodeType){if(!l){r.removeAttribute("data-i18n");continue}o=r.innerHTML}else o=r.childNodes[0].nodeValue,r.setAttribute("data-i18n",o)}l?r.innerHTML=this.translate(o):e?r.innerHTML=this.translate(o).replace(/[&'`"<>]/g,function(t){return{"&":"&amp;","'":"&#x27;","`":"&#x60;",'"':"&quot;","<":"&lt;",">":"&gt;"}[t]}):r.textContent=this.translate(o)}},t.prototype.setLanguage=function(t,e){if(e||"undefined"==typeof localStorage||(e=localStorage),!e)throw new Error("localStorage is needed to store language");e.setItem("i18n4v.language",t)},t.prototype.selectLanguage=function(t,e,n){var a=this;if(e)return void this._selectLanguage(t,e,n);if("undefined"==typeof Promise)throw new Error("selectLanguage needs callback function or Promise should be supported");return new Promise(function(e,r){a._selectLanguage(t,function(t,n){t?e(n):r(t)},n)})},t.prototype._selectLanguage=function(t,e,n){function a(){for(var n=0;n<r.length;n++){var a=r[0];if(t.indexOf(a)!==-1)return e(null,a)}e(new Error("preferred Language is not found"),null)}var r=[];if(n||"undefined"==typeof localStorage||(n=localStorage),n){var o=n.getItem("i18n4v.language");if(t.indexOf(o)!==-1)return e(null,o)}if("undefined"!=typeof module&&module.require)module.require("os-locale")(function(t,e){r.push(e,e.split("_")[0]),a()});else{r.push(navigator.language);var l;for(l=0;l<navigator.languages.length;l++)r.push(navigator.languages[l]);for(l=0;l<navigator.languages.length;l++)r.push(navigator.languages[l].split("_")[0]);a()}};var n=new t,a=function(){return n.translate.apply(n,arguments)};return a.translator=n,a.create=function(e){var n=new t;return null!=e&&n.add(e),n.translate.create=a.create,function(){return n.translate.apply(n,arguments)}},a});
//# sourceMappingURL=index.js.map